<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cubo IoT</title>
    <link rel="stylesheet" href="style.css">
    <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css"> -->
    <link rel="stylesheet" href="https://unpkg.com/@coreui/coreui/dist/css/coreui.min.css">
    <link rel="shortcut icon" href="src/img/cubo.ico" type="image/x-icon">

</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarTogglerDemo03"
            aria-controls="navbarTogglerDemo03" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <a class="navbar-brand" href="\" style="margin-left: 4%;"><img
                src="https://cdn-icons-png.flaticon.com/512/84/84583.png" alt="" srcset="" style="height:2rem;"> Cubo
            IoT</a>
        <div class="collapse navbar-collapse" id="navbarTogglerDemo03">
            <ul class="navbar-nav mr-auto mt-2 mt-lg-0">
                <li class="nav-item active">
                    <a class="nav-link" href="\">Inicio</span></a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="https://github.com/AbrahamFB/Cubo-4x4x4">Código</a>
                </li>

            </ul>

        </div>
    </nav>

    <div class="container">
        <div class="card-group" style="padding-top: 10%;">
            <div class="card" id="fondo">
                <img src="src/img/1.jpg" alt="" srcset="" width="100%" height="100%">

                <div class="card-body">
                    <h5 class="card-title">Patrón 1</h5>
                    <p class="card-text">Prende hacia una dirección y a otra, posteriormente prende de nivel inferior a superior.</p>
                </div>
                <div class="card-footer">
                    <div class="row">
                        <div class="col-6 text-center">
                            <button onclick="command(01)" type="button"
                                class="btn btn-success">Encender</button><br><br>
                        </div>
                        <div class="col-6 text-center">
                            <button onclick="command(00)" type="button" class="btn btn-danger">Apagar</button><br><br>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card" id="fondo">
                <img src="src/img/2.jpg" alt="" srcset="" width="100%" height="100%">

                <div class="card-body">
                    <h5 class="card-title">Patrón 2</h5>
                    <p class="card-text">Se genera un cubo interno de 2x2 posteriormente se prende led por led ajeno al cubo 2x2.</p>
                </div>
                <div class="card-footer">
                    <div class="row">
                        <div class="col-6 text-center">
                            <button onclick="command(11)" type="button"
                                class="btn btn-success">Encender</button><br><br>
                        </div>
                        <div class="col-6 text-center">
                            <button onclick="command(10)" type="button" class="btn btn-danger">Apagar</button><br><br>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card" id="fondo">
                <img src="src/img/3.jpg" alt="" srcset="" width="100%" height="100%">

                <div class="card-body">
                    <h5 class="card-title">Patrón 3</h5>
                    <p class="card-text">Lluvia agresiva down-up</p>
                </div>
                <div class="card-footer">
                    <div class="row">
                        <div class="col-6 text-center">
                            <button onclick="command(21)" type="button"
                                class="btn btn-success">Encender</button><br><br>
                        </div>
                        <div class="col-6 text-center">
                            <button onclick="command(20)" type="button" class="btn btn-danger">Apagar</button><br><br>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card" id="fondo">
                <img src="src/img/4.jpg" alt="" srcset="" width="100%" height="100%">

                <div class="card-body">
                    <h5 class="card-title">Patrón 4</h5>
                    <p class="card-text">Recorrido con Zigzag.</p>
                </div>
                <div class="card-footer">
                    <div class="row">
                        <div class="col-6 text-center">
                            <button onclick="command(31)" type="button"
                                class="btn btn-success">Encender</button><br><br>
                        </div>
                        <div class="col-6 text-center">
                            <button onclick="command(30)" type="button" class="btn btn-danger">Apagar</button><br><br>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card" id="fondo">
                <img src="src/img/5.jpg" alt="" srcset="" width="100%" height="100%">

                <div class="card-body">
                    <h5 class="card-title">Patrón 5</h5>
                    <p class="card-text">Columnas giratorias</p>
                </div>
                <div class="card-footer">
                    <div class="row">
                        <div class="col-6 text-center">
                            <button onclick="command(41)" type="button"
                                class="btn btn-success">Encender</button><br><br>
                        </div>
                        <div class="col-6 text-center">
                            <button onclick="command(40)" type="button" class="btn btn-danger">Apagar</button><br><br>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <div class="col-md-4 offset-md-4">
        </div>
        <div class="col-sm-12 col-lg-12 fixed-bottom">
            <div class="card bg-light">
                <div class="card-body row text-center">
                    <div class="col">
                        <div class="text-value-xl" id="mens">
                            <button type="button" class="btn btn-danger">
                                Sin Mensajes
                            </button>
                        </div>
                        <div class="text-uppercase text-muted small">Mensajes</div>
                    </div>
                    <div class="vr"></div>
                    <div class="col">
                        <div class="text-value-xl">
                            <button type="button" class="btn btn-light">
                                Patrón <span class="badge bg-secondary" id="patron">Ninguno</span>
                            </button>
                        </div>
                    </div>
                    <div class="vr"></div>
                    <div class="col">
                        <div class="text-value-xl">
                            <button type="button" class="btn btn-light">
                                Interacciones <span class="badge bg-secondary" id="interacciones">0</span>
                            </button>
                        </div>
                        <!-- <div class="text-uppercase text-muted small">Interacciones</div> -->

                    </div>
                    <div class="vr"></div>

                    <div class="col">
                        <div class="text-value-xl">
                            <button type="button" class="btn btn-light">
                                Servicio <span class="badge" id="estado"></span>
                            </button>
                        </div>
                        <div class="text-value-xl">
                            <button type="button" class="btn btn-light">
                                Placa <span class="badge bg-danger" id="estadoP">Desconectada</span>
                            </button>
                        </div>

                        <!-- <div class="text-uppercase text-muted small">Estado</div> -->
                    </div>
                </div>
            </div>
        </div>

        <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
        crossorigin="anonymous"></script>

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"
        integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js"
        integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13"
        crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script> -->

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
            crossorigin="anonymous"></script>


        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.js"
            type="text/javascript"></script>

        <script type="text/javascript">
            var clientId = "client_id_" + Math.floor((Math.random() * 1000000) + 1);
            var i = 0;
            client = new Paho.MQTT.Client("driver.cloudmqtt.com", 38651, clientId);


            //eventos
            client.onConnectionLost = onConnectionLost;
            client.onMessageArrived = onMessageArrived;

            var options = {
                useSSL: true,
                userName: "clxxwiek",
                password: "PtsiiKX9xhVm",
                onSuccess: onConnect,
                onFailure: doFail //se genera en caso de una conexión no exitosa
            }

            client.connect(options);

            function onConnect() {
                console.log("Conexión exitosa!!!");
                client.subscribe("afb1");
                let es = document.querySelector("#estado");

                es.innerHTML = 'Funcionando';
                es.classList.add("bg-success");
            }

            function onMessageArrived(message) {
                let men = document.querySelector("#mens");
                console.log("Un mensaje ha llegado: " + message.payloadString);
                let esP = document.querySelector("#estadoP");
                esP.innerHTML = 'Conectada';
                esP.classList.replace("bg-danger", "bg-success");
                men.innerHTML = message.payloadString;
            }

            function doFail(e) {
                console.log(e);
            }

            function onConnectionLost(responseObject) {
                if (responseObject.errorCode !== 0) {
                    console.log("onConnectionLost: " + responseObject.errorMessage);
                    let es = document.querySelector("#estado");
                    es.innerHTML = 'Error -> ' + responseObject.errorMessage;
                    es.classList.add("bg-danger");
                }
            }
            function command(value) {
                let men = document.querySelector("#mens");
                let inte = document.querySelector("#interacciones");
                let pat = document.querySelector("#patron");
                let p;
                i += 1;

                if (value != 01 && value != 11 && value != 21 && value != 31 && value != 41) {
                    p = "Ninguno";
                    pa = 0;
                } else {
                    if (value == 01) {
                        p = 1;
                        pa = 1;
                    }
                    if (value == 11) {
                        p = 2;
                        pa = 2;
                    }
                    if (value == 21) {
                        p = 3;
                        pa = 3;
                    }
                    if (value == 31) {
                        p = 4;
                        pa = 4;
                    }
                    if (value == 41) {
                        p = 5;
                        pa = 5;
                    }
                }

                console.log(pa);
                message = new Paho.MQTT.Message(pa + "");
                message.destinationName = "afb1";
                men.innerHTML = message.payloadString;

                client.send(message);
                pat.innerHTML = p;
                inte.innerHTML = i;
            }

    //driver.cloudmqtt.com

        </script>

        <script src="https://unpkg.com/@popperjs/core@2"></script>
        <script src="https://unpkg.com/@coreui/coreui/dist/js/coreui.min.js"></script>

        <script src="https://unpkg.com/@coreui/coreui/dist/js/coreui.bundle.min.js"></script>
</body>

</html>